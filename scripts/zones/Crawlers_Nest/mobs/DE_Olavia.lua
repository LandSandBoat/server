-----------------------------------
-- Area: Crawlers Nest
--  Mob: Wanzo-Unzozo
-- Type: Quest mob (Escort for Hire - Windurst)
-- TODO: Convert to Olavia
-----------------------------------
local ID = zones[xi.zone.CRAWLERS_NEST]
-----------------------------------

local paths =
{
    a = -- Path 1: Ends in small exoray room otw to Simurgh
    {
        { 381.3447, -32.2567, -8.3768 }, -- Start
        { 380.7764, -32.2794, -14.1979 },
        { 376.2621, -32.4510, -18.7491 },
        { 370.8670, -32.4333, -21.2462 },
        { 368.1850, -32.3265, -21.8799 },
        { 352.9693, -32.2435, -22.2869 },
        { 341.3745, -32.3276, -17.6279 },
        { 334.0105, -32.2944, -15.4963 },
        { 310.8332, -32.4397, -20.8502 },
        { 303.2164, -32.5323, -27.1331 },
        { 297.9025, -32.3312, -32.7542 },
        { 300.2100, -32.3818, -45.7884 },
        { 301.2853, -32.1733, -49.3411 },
        { 298.0365, -32.2140, -57.7255 },
        { 290.4510, -32.3429, -61.2076 },
        { 281.7618, -32.1701, -59.7992 },
        { 272.5338, -32.2497, -60.3747 },
        { 264.8572, -32.3155, -60.8206 },
        { 261.2990, -32.4189, -56.4941 },
        { 258.9738, -32.2314, -46.7526 },
        { 261.6687, -32.1467, -36.5427 },
        { 261.0997, -32.4687, -28.7481 },
        { 254.9180, -32.2382, -19.2297 },
        { 246.3533, -32.3331, -20.5350 },
        { 231.4488, -32.3491, -20.3175 },
        { 215.1779, -32.4704, -18.9185 },
        { 202.5445, -32.1740, -19.7428 },
        { 193.4743, -32.2951, -18.3884 },
        { 186.7378, -32.3773, -16.1250 },
        { 180.5833, -32.4501, -17.4265 },
        { 171.5948, -32.3908, -20.9317 },
        { 155.0334, -32.1454, -18.3030 },
        { 150.9698, -32.3579, -18.3564 },
        { 140.2580, -32.3426, -23.4279 },
        { 138.3673, -32.1804, -27.4211 },
        { 139.9486, -32.1336, -33.7026 },
        { 140.1400, -32.2996, -41.2877 },
        { 141.0342, -34.2681, -48.2925 },
        { 139.1214, -37.0170, -57.3631 },
        { 132.8841, -39.7977, -66.5405 },
        { 128.0140, -40.3259, -71.7650 }, -- First Drop
        { 127.7454, -40.3030, -71.7107 },
        { 123.0359, -33.3000, -74.5166 },
        { 117.6301, -32.2287, -74.2277 },
        { 117.6301, -32.2287, -74.2277 },
        { 118.1947, -32.3125, -68.3747 },
        { 112.6788, -32.8446, -64.4025 },
        { 105.7168, -32.3527, -63.9073 }, -- Map 1: Main Room NE tunnel entrance
        { 102.7752, -32.3240, -59.7220 },
        { 100.4450, -32.1890, -42.2048 },
        { 100.9874, -32.3288, -30.2169 },
        { 96.5960, -32.5201, -15.9217 },
        { 100.3110, -32.2230, -4.8047 },
        { 98.8871, -32.1199, 5.5700 },
        { 103.5664, -32.3832, 19.2404 },
        { 108.7266, -32.5478, 28.4117 },
        { 116.0874, -33.2033, 31.3883 },
        { 122.7088, -33.1901, 39.7594 },
        { 126.1107, -32.5661, 49.1362 }, -- Turn around at Dead End
        { 122.7088, -33.1901, 39.7594 },
        { 116.0874, -33.2033, 31.3883 },
        { 108.7266, -32.5478, 28.4117 },
        { 103.5664, -32.3832, 19.2404 },
        { 98.8871, -32.1199, 5.5700 },
        { 100.3110, -32.2230, -4.8047 },
        { 96.5960, -32.5201, -15.9217 },
        { 100.9874, -32.3288, -30.2169 },
        { 100.4450, -32.1890, -42.2048 },
        { 102.7752, -32.3240, -59.7220 },
        { 106.4756, -32.3293, -64.7150 },
        { 104.3531, -32.6077, -71.5879 }, -- End of shard portion #1 of Path 1 and 2
        { 103.8580, -32.3406, -93.6943 },
        { 93.0787, -32.4533, -97.6689 },
        { 77.4704, -32.2945, -99.1867 },
        { 65.5875, -32.6523, -95.4683 },
        { 48.2843, -32.3290, -99.5902 },
        { 29.3315, -32.3414, -101.3267 },
        { 17.7475, -32.1776, -96.5142 },
        { 18.6711, -32.3618, -66.3626 },
        { 10.0946, -32.3061, -59.4070 },
        { -19.6134, -32.1228, -64.5287 },
        { -22.0045, -32.6065, -73.5919 },
        { -19.4152, -32.2769, -91.0373 },
        { -34.0408, -32.3369, -99.7128 },
        { -59.6221, -32.3221, -103.1230 },
        { -71.1010, -32.3331, -98.0183 },
        { -87.9420, -32.2729, -101.5239 },
        { -103.6686, -32.3278, -94.6696 },
        { -124.8589, -32.7915, -96.5054 },
        { -129.8330, -33.2320, -93.2016 },
        { -134.6627, -32.3278, -63.8271 },
        { -141.6208, -32.2317, -47.5526 },
        { -138.7644, -32.3399, -31.2125 },
        { -144.0611, -32.6199, -14.7304 },
        { -140.6601, -32.2877, -5.0945 },
        { -140.9491, -32.3366, 11.8239 },
        { -136.6792, -33.7044, 19.0455 }, -- Turn Around at Dead End
        { -140.9491, -32.3366, 11.8239 },
        { -140.6601, -32.2877, -5.0945 },
        { -144.0611, -32.6199, -14.7304 },
        { -138.7644, -32.3399, -31.2125 },
        { -141.6208, -32.2317, -47.5526 },
        { -134.6627, -32.3278, -63.8271 },
        { -129.8330, -33.2320, -93.2016 },
        { -124.8589, -32.7915, -96.5054 },
        { -103.6686, -32.3278, -94.6696 },
        { -87.9420, -32.2729, -101.5239 },
        { -71.1010, -32.3331, -98.0183 },
        { -59.6221, -32.3221, -103.1230 },
        { -34.0408, -32.3369, -99.7128 },
        { -19.4152, -32.2769, -91.0373 },
        { -22.0045, -32.6065, -73.5919 },
        { -19.6134, -32.1228, -64.5287 },
        { 10.0946, -32.3061, -59.4070 },
        { 18.6711, -32.3618, -66.3626 },
        { 17.7475, -32.1776, -96.5142 },
        { 29.3315, -32.3414, -101.3267 },
        { 48.2843, -32.3290, -99.5902 },
        { 65.5875, -32.6523, -95.4683 },
        { 77.4704, -32.2945, -99.1867 },
        { 93.0787, -32.4533, -97.6689 },
        { 103.8580, -32.3406, -93.6943 },
        { 102.9353, -32.3886, -75.2923 }, -- Map 1: Main Room NW tunnel entrance to Map 2
        { 98.0818, -32.4784, -71.9975 },
        { 95.6933, -32.3441, -70.7534 },
        { 88.9789, -32.1333, -64.2870 },
        { 79.8130, -32.0108, -60.0328 },
        { 67.2767, -32.4418, -60.8515 },
        { 59.1874, -32.1777, -56.8726 },
        { 58.6040, -32.1380, -45.4144 },
        { 61.1255, -35.1117, -29.3240 },
        { 61.1255, -35.1117, -29.3240 },
        { 63.4120, -38.3390, -18.6081 },
        { 59.5270, -32.1233, 0.6942 },
        { 62.0581, -28.4837, 15.6361 },
        { 44.1972, -24.7122, 21.8197 },
        { 31.9944, -22.2678, 20.4436 },
        { 23.7402, -20.2364, 21.3578 },
        { 17.9996, -17.0621, 6.3915 },
        { 19.6035, -14.0043, -9.5251 },
        { 18.6677, -12.5416, -15.4792 },
        { 28.0539, -10.5085, -20.1983 },
        { 33.5308, -9.0925, -21.4662 },
        { 47.4604, -6.4026, -20.0018 },
        { 54.9602, -4.8035, -23.3369 },
        { 61.2044, -1.6735, -8.8434 },
        { 60.5815, -0.4997, 7.3016 },
        { 61.9331, -0.4400, 21.1595 },
        { 60.1988, -0.0314, 40.4456 },
        { 59.4880, 0.0923, 72.6083 },
        { 61.5344, -0.2253, 85.3576 },
        { 59.8509, -0.3458, 116.1773 },
        { 60.5360, -0.3288, 131.3554 },
        { 56.5013, -0.4241, 146.2754 },
        { 60.0513, -0.1843, 156.3283 },
        { 60.7277, -4.4233, 175.1337 },
        { 51.5044, -8.3099, 187.7407 },
        { 50.9221, -8.6965, 189.6655 }, -- Drop on Map 2: Main Room
        { 47.1096, -8.0559, 191.6120 },
        { 43.6760, -1.8966, 194.2386 },
        { 42.7169, -1.1370, 195.9807 },
        { 51.2310, -0.2242, 205.5889 },
        { 54.8374, -0.5267, 213.1877 }, -- Map 2: Main room NE tunnel entrance
        { 72.1872, -0.2800, 221.7178 },
        { 90.7742, -0.4290, 218.2688 },
        { 100.2931, -0.3292, 222.2032 },
        { 101.2964, -0.4606, 229.7376 },
        { 101.3110, -0.3479, 255.6052 },
        { 94.9292, -0.5505, 259.4594 },
        { 86.6518, -0.1990, 261.4992 },
        { 63.9463, -0.3628, 260.0876 },
        { 61.1815, -0.4544, 263.1552 }, -- Path 1 complete
    },
    b = -- Path 2: Ends in Big Exoray room
    {
        { 381.3447, -32.2567, -8.3768 }, --Start
        { 380.7764, -32.2794, -14.1979 },
        { 376.2621, -32.4510, -18.7491 },
        { 370.8670, -32.4333, -21.2462 },
        { 368.1850, -32.3265, -21.8799 },
        { 352.9693, -32.2435, -22.2869 },
        { 341.3745, -32.3276, -17.6279 },
        { 334.0105, -32.2944, -15.4963 },
        { 310.8332, -32.4397, -20.8502 },
        { 303.2164, -32.5323, -27.1331 },
        { 297.9025, -32.3312, -32.7542 },
        { 300.2100, -32.3818, -45.7884 },
        { 301.2853, -32.1733, -49.3411 },
        { 298.0365, -32.2140, -57.7255 },
        { 290.4510, -32.3429, -61.2076 },
        { 281.7618, -32.1701, -59.7992 },
        { 272.5338, -32.2497, -60.3747 },
        { 264.8572, -32.3155, -60.8206 },
        { 261.2990, -32.4189, -56.4941 },
        { 258.9738, -32.2314, -46.7526 },
        { 261.6687, -32.1467, -36.5427 },
        { 261.0997, -32.4687, -28.7481 },
        { 254.9180, -32.2382, -19.2297 },
        { 246.3533, -32.3331, -20.5350 },
        { 231.4488, -32.3491, -20.3175 },
        { 215.1779, -32.4704, -18.9185 },
        { 202.5445, -32.1740, -19.7428 },
        { 193.4743, -32.2951, -18.3884 },
        { 186.7378, -32.3773, -16.1250 },
        { 180.5833, -32.4501, -17.4265 },
        { 171.5948, -32.3908, -20.9317 },
        { 155.0334, -32.1454, -18.3030 },
        { 150.9698, -32.3579, -18.3564 },
        { 140.2580, -32.3426, -23.4279 },
        { 138.3673, -32.1804, -27.4211 },
        { 139.9486, -32.1336, -33.7026 },
        { 140.1400, -32.2996, -41.2877 },
        { 141.0342, -34.2681, -48.2925 },
        { 139.1214, -37.0170, -57.3631 },
        { 132.8841, -39.7977, -66.5405 },
        { 128.0140, -40.3259, -71.7650 }, -- First Drop
        { 127.7454, -40.3030, -71.7107 },
        { 123.0359, -33.3000, -74.5166 },
        { 117.6301, -32.2287, -74.2277 },
        { 117.6301, -32.2287, -74.2277 },
        { 118.1947, -32.3125, -68.3747 },
        { 112.6788, -32.8446, -64.4025 },
        { 105.7168, -32.3527, -63.9073 }, -- Map 1: Main Room NE tunnel entrance
        { 102.7752, -32.3240, -59.7220 },
        { 100.4450, -32.1890, -42.2048 },
        { 100.9874, -32.3288, -30.2169 },
        { 96.5960, -32.5201, -15.9217 },
        { 100.3110, -32.2230, -4.8047 },
        { 98.8871, -32.1199, 5.5700 },
        { 103.5664, -32.3832, 19.2404 },
        { 108.7266, -32.5478, 28.4117 },
        { 116.0874, -33.2033, 31.3883 },
        { 122.7088, -33.1901, 39.7594 },
        { 126.1107, -32.5661, 49.1362 }, -- Turn around at Dead End
        { 122.7088, -33.1901, 39.7594 },
        { 116.0874, -33.2033, 31.3883 },
        { 108.7266, -32.5478, 28.4117 },
        { 103.5664, -32.3832, 19.2404 },
        { 98.8871, -32.1199, 5.5700 },
        { 100.3110, -32.2230, -4.8047 },
        { 96.5960, -32.5201, -15.9217 },
        { 100.9874, -32.3288, -30.2169 },
        { 100.4450, -32.1890, -42.2048 },
        { 102.7752, -32.3240, -59.7220 },
        { 106.4756, -32.3293, -64.7150 },
        { 104.3531, -32.6077, -71.5879 }, -- Map 1: Main Room NW tunnel entrance to Map 2
        { 98.0818, -32.4784, -71.9975 },
        { 95.6933, -32.3441, -70.7534 },
        { 88.9789, -32.1333, -64.2870 },
        { 79.8130, -32.0108, -60.0328 },
        { 67.2767, -32.4418, -60.8515 },
        { 59.1874, -32.1777, -56.8726 },
        { 58.6040, -32.1380, -45.4144 },
        { 61.1255, -35.1117, -29.3240 },
        { 61.1255, -35.1117, -29.3240 },
        { 63.4120, -38.3390, -18.6081 },
        { 59.5270, -32.1233, 0.6942 },
        { 62.0581, -28.4837, 15.6361 },
        { 44.1972, -24.7122, 21.8197 },
        { 31.9944, -22.2678, 20.4436 },
        { 23.7402, -20.2364, 21.3578 },
        { 17.9996, -17.0621, 6.3915 },
        { 19.6035, -14.0043, -9.5251 },
        { 18.6677, -12.5416, -15.4792 },
        { 28.0539, -10.5085, -20.1983 },
        { 33.5308, -9.0925, -21.4662 },
        { 47.4604, -6.4026, -20.0018 },
        { 54.9602, -4.8035, -23.3369 },
        { 61.2044, -1.6735, -8.8434 },
        { 60.5815, -0.4997, 7.3016 },
        { 61.9331, -0.4400, 21.1595 },
        { 60.1988, -0.0314, 40.4456 },
        { 59.4880, 0.0923, 72.6083 },
        { 61.5344, -0.2253, 85.3576 },
        { 59.8509, -0.3458, 116.1773 },
        { 60.5360, -0.3288, 131.3554 },
        { 56.5013, -0.4241, 146.2754 },
        { 60.0513, -0.1843, 156.3283 },
        { 60.7277, -4.4233, 175.1337 },
        { 51.5044, -8.3099, 187.7407 },
        { 50.9221, -8.6965, 189.6655 }, -- Drop on Map 2: Main Room
        { 47.4790, -8.3346, 190.8256 },
        { 25.1786, -0.3901, 186.2498 }, -- Map 2: Main Room SW tunnel entrance
        { 8.0340, -0.3132, 178.9084 },
        { -9.6546, -1.8586, 181.0912 },
        { -21.4636, -4.2583, 176.2601 },
        { -19.4001, -8.1601, 153.6429 },
        { -20.4408, -8.2862, 144.8513 },
        { -25.4673, -8.2799, 140.5096 },
        { -45.7802, -8.1841, 142.0538 },
        { -49.3012, -8.3733, 143.1602 },
        { -56.1311, -8.3495, 143.0917 },
        { -60.5633, -8.3338, 138.5979 },
        { -58.2980, -8.1619, 125.2784 },
        { -59.1405, -8.2290, 112.7642 },
        { -65.0291, -8.3280, 95.3938 },
        { -77.2130, -8.1828, 88.4509 },
        { -82.8995, -8.1786, 78.9645 },
        { -82.8390, -8.3069, 64.6419 } -- Path 2 Complete
    },
    c = -- Incomplete Path 3: Ends on map 3 near rumble crawlers(verify)
    {
        { 381.3447, -32.2567, -8.3768 }, -- Start
        { 380.7764, -32.2794, -14.1979 },
        { 376.2621, -32.4510, -18.7491 },
        { 370.8670, -32.4333, -21.2462 },
        { 368.1850, -32.3265, -21.8799 },
        { 352.9693, -32.2435, -22.2869 },
        { 341.3745, -32.3276, -17.6279 },
        { 334.0105, -32.2944, -15.4963 },
        { 310.8332, -32.4397, -20.8502 },
        { 303.2164, -32.5323, -27.1331 },
        { 297.9025, -32.3312, -32.7542 },
        { 300.2100, -32.3818, -45.7884 },
        { 301.2853, -32.1733, -49.3411 },
        { 298.0365, -32.2140, -57.7255 },
        { 290.4510, -32.3429, -61.2076 },
        { 281.7618, -32.1701, -59.7992 },
        { 272.5338, -32.2497, -60.3747 },
        { 264.8572, -32.3155, -60.8206 },
        { 261.2990, -32.4189, -56.4941 },
        { 258.9738, -32.2314, -46.7526 },
        { 261.6687, -32.1467, -36.5427 },
        { 261.0997, -32.4687, -28.7481 },
        { 254.9180, -32.2382, -19.2297 },
        { 246.3533, -32.3331, -20.5350 },
        { 231.4488, -32.3491, -20.3175 },
        { 215.1779, -32.4704, -18.9185 },
        { 202.5445, -32.1740, -19.7428 },
        { 193.4743, -32.2951, -18.3884 },
        { 186.7378, -32.3773, -16.1250 },
        { 180.5833, -32.4501, -17.4265 },
        { 171.5948, -32.3908, -20.9317 },
        { 155.0334, -32.1454, -18.3030 },
        { 150.9698, -32.3579, -18.3564 },
        { 140.2580, -32.3426, -23.4279 },
        { 138.3673, -32.1804, -27.4211 },
        { 139.9486, -32.1336, -33.7026 },
        { 140.1400, -32.2996, -41.2877 },
        { 141.0342, -34.2681, -48.2925 },
        { 139.1214, -37.0170, -57.3631 },
        { 132.8841, -39.7977, -66.5405 },
        { 128.0140, -40.3259, -71.7650 }, -- First Drop
    }
}

local path = paths.a -- Only one path works atm

local escortProgress =
{
    NONE     = 0, -- Have not started pathing at all yet
    ENROUTE  = 1, -- Started pathing and is continuing along path
    PAUSED   = 2, -- Has paused pathing and awaiting orders
    COMPLETE = 3, -- Has reached the end of the escort mission
}

local party = {}

local entity = {}

entity.shouldMove = function(mob, progress)
    return not mob:isFollowingPath() and mob:getStatus() == xi.status.NORMAL and progress ~= escortProgress.COMPLETE
end

entity.onMobInitialize = function(mob)
    mob:setLocalVar('progress', escortProgress.NONE)
    mob:setSpeed(60)

    mob:setMobMod(xi.mobMod.NO_MOVE, 1)
    mob:setMobMod(xi.mobMod.NO_DESPAWN, 1)
    mob:setAutoAttackEnabled(true)
end

entity.onMobRoam = function(mob)
    mob:setStatus(xi.status.NORMAL)
    local progress = mob:getLocalVar('progress')
    local escortID = '[Escort]Olavia'
    local checkEscort = GetServerVariable(escortID)
    local player = GetPlayerByID(mob:getLocalVar('player'))

    local now = os.time()
    local expire = mob:getLocalVar('expire')
    if expire ~= 0 and expire <= now then
        if progress ~= escortProgress.COMPLETE then
            mob:showText(mob, ID.text.RAN_OUT_OF_TIME)
        end

        mob:setLocalVar('progress', escortProgress.NONE)
        DespawnMob(mob:getID())
        SetServerVariable(escortID, 0)
        for _, v in ipairs(player:getParty()) do
            utils.setQuestVar(v, 1, 70, 'Prog', 0)
        end

        return
    else
        local i = 0
        if next(party) ~= nil then
            for _, v in ipairs(party) do
                if v:getZoneID() == xi.zone.CRAWLERS_NEST then
                    i = i + 1
                end
            end

            if i == 0 then -- Players in party on quest no longer in zone reset the escort
                DespawnMob(checkEscort)
                SetServerVariable(escortID, 0)
                for _, v in ipairs(party) do
                    utils.setQuestVar(v, 1, 70, 'Prog', 0)
                end
            end
        end
    end
end

entity.onPath = function(mob)
    local progress = mob:getLocalVar('progress')
    local escort = mob:getLocalVar('escort')
    local player = GetPlayerByID(mob:getLocalVar('player'))

    if escort ~= nil and entity.shouldMove(mob, progress) then
        local point = mob:getLocalVar('point')
        if point == #path then
            mob:setLocalVar('progress', escortProgress.COMPLETE)
            for _, v in ipairs(player:getParty()) do
                local prog = utils.getQuestVar(v, 1, 70, 'Prog')
                if prog == 2 then
                    utils.setQuestVar(v, 1, 70, 'Prog', 3) -- Completes the quest
                elseif prog == 1 then
                    utils.setQuestVar(v, 1, 70, 'Prog', 0) -- Resets the quest for players not in zone when escort started
                end
            end
        elseif progress ~= escortProgress.COMPLETE then
            point = point + 1
            mob:setLocalVar('point', point)
            mob:pathThrough(path[point], xi.path.flag.WALK)
        end
    end
end

entity.onTrigger = function(player, mob)
    local progress = mob:getLocalVar('progress')
    local point = mob:getLocalVar('point')
    local escort = mob:getLocalVar('escort')
    local questVar = utils.getQuestVar(player, 1, 70, 'Prog')

    if escort ~= nil then
        if progress == escortProgress.ENROUTE then
            mob:pathThrough(mob:getPos(), xi.path.flag.NONE)
            mob:showText(mob, ID.text.ANYTHING_WRONG)
            mob:setLocalVar('progress', escortProgress.PAUSED)
        elseif progress == escortProgress.PAUSED then
            mob:showText(mob, ID.text.COME_ON_FOLLOW_ME)
            mob:setLocalVar('progress', escortProgress.ENROUTE)
            mob:pathThrough(path[point], xi.path.flag.WALK)
        elseif progress == escortProgress.NONE then
            if GetPlayerByID(mob:getLocalVar('player')) == player then -- Only the player that got the CS can start
                mob:showText(mob, ID.text.ARE_YOU_READY)
                mob:setLocalVar('progress', escortProgress.ENROUTE)
                mob:setLocalVar('point', 1)
                mob:pathThrough(path[1], xi.path.flag.WALK)
                utils.setQuestVar(player, 1, 70, 'Prog', 2) -- Have to progress the player outside of the loop for some reason
                for _, v in ipairs(player:getParty()) do
                    if v:getZone() == mob:getZone() then
                        utils.setQuestVar(v, 1, 70, 'Prog', 2) -- Only players in zone when escort starts can progress
                        table.insert(party, v)
                    else
                        utils.setQuestVar(v, 1, 70, 'Prog', 0) -- Sets progress back to 0 to cover any wierdness
                    end
                end
            end
        elseif progress == escortProgress.COMPLETE then
            if questVar == 3 then
                mob:showText(mob, ID.text.GREAT_HELP)
                npcUtil.giveKeyItem(player, xi.ki.COMPLETION_CERTIFICATE)
                utils.setQuestVar(player, 1, 70, 'Prog', 4)
                mob:isAggroable(false)
            end

            for _, v in ipairs(player:getParty()) do
                if utils.getQuestVar(v, 1, 70, 'Prog') == 4 then
                    mob:isAggroable(false)
                    mob:timer(60000, function(mobArg)
                        mob:showText(mob, ID.text.BEEN_A_PLEASURE)
                        mob:setStatus(xi.status.INVISIBLE)
                        DespawnMob(mob:getID())
                    end)
                end
            end
        end
    end
end

entity.onMobEngaged = function(mob, target)
end

entity.onMobDisengage = function(mob)
    if mob:getLocalVar('progress') == escortProgress.ENROUTE then
        local point = mob:getLocalVar('point')
        mob:pathThrough(path[point], xi.path.flag.WALK)
    end
end

entity.onMobDeath = function(mob, player, optParams)
    mob:setStatus(xi.status.INVISIBLE)
end

entity.onMobDespawn = function(mob)
    local escortID = '[Escort]Olavia'

    SetServerVariable(escortID, 0)
end

return entity
