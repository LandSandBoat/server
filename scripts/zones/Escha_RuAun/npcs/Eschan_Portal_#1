-----------------------------------
-- Area: Escha - Ru'Aun
--  NPC: Eschan Portal #1
-----------------------------------
require("scripts/zones/Escha_RuAun/IDs")
require("scripts/globals/npc_util")
require("scripts/globals/items")
require("scripts/globals/utils")
-----------------------------------
local entity = {}
local siltCost = 50
local unlock
local droplets

entity.onTrade = function(player, npc, trade)
end

entity.onTrigger = function(player, npc)
    if (player:getCharVar("EschaRuAunPortalUnlock") == nil) then
        unlock = 319
    else
        unlock = player:getCharVar("EschaRuAunPortalUnlock")
    end

    if (player:hasItem(9148)) then
        droplets = 3
    else
        droplets = 0
    end

--                    (Event ID, ???, unlock, zoneID, currentportalid, hasdroplets, playersSilt,                  siltCost, ???) 
        player:startEvent(9100,   0,  unlock, 289,      8,             droplets, player:getCurrency("escha_silt") , siltCost, 1)
end

entity.onEventUpdate = function(player, csid, option)
end

entity.onEventFinish = function(player, csid, option)
    if option == 1 then
        player:delCurrency("escha_silt", siltCost)
    end

    if option == 3 then
        -- option 3 deals with the escha portals unlocks so put something here to deal with that
        player:delItem(9148, 1)
        if (player:getCharVar("EschaRuAunPortalUnlock") == -1) then

        elseif (player:getCharVar("EschaRuAunPortalUnlock") < 831) then
            player:setCharVar("EschaRuAunPortalUnlock", 831)
        end
    end
end

return entity
    
